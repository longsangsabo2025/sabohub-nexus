# ðŸ§ª AUTO-DELEGATE E2E TEST GUIDE

## âœ… PRE-REQUISITES CHECK

### 1. Dev Server Status
- [ ] Server running on http://localhost:9001
- [ ] No console errors on homepage
- [ ] Can login as CEO user

### 2. Database Status
- [x] Company record exists (SABO Billiards - feef10d3-899d-4554-8107-b2256918213a)
- [x] CEO user linked (owner_id: 944f7536-6c9a-4bea-99fc-f1c984fef2ef)
- [x] Employees exist
- [x] Tasks data available

### 3. AI Configuration
- [x] Gemini API key configured: AIzaSyDphjRnTD8zsZeRRo1UDlMyVR9m6Okj1m0
- [x] AI provider set to 'gemini'
- [x] Model: gemini-2.5-flash (latest)

---

## ðŸŽ¯ E2E TEST FLOW

### STEP 1: Login & Navigate
```
1. Open: http://localhost:9001
2. Login as CEO
3. Navigate to: /ai-assistant
4. Expected: 
   âœ“ Dashboard loads
   âœ“ Metrics cards show data
   âœ“ AI Insights panel visible
   âœ“ Chat interface ready
```

**Verification:**
- [ ] Page loads without errors
- [ ] Metrics show: Active Team, Completion Rate, Active Goals, AI Insights
- [ ] Chat history empty or showing previous messages
- [ ] Input box enabled

---

### STEP 2: Test Keyword Detection
```
1. Type in chat: "Giao 10 viá»‡c cáº¥p bÃ¡ch cho manager"
2. Press Enter
3. Watch console logs
```

**Expected Console Output:**
```javascript
ðŸ” Auto-Delegate Detection: {
  inputMessage: 'Giao 10 viá»‡c cáº¥p bÃ¡ch cho manager',
  shouldAutoDelegate: true,
  hasMetrics: true,
  hasInsights: true,
  willTrigger: true
}
ðŸŽ¯ Detected delegation intent, triggering Auto-Delegate...
```

**Verification:**
- [ ] Console shows detection log
- [ ] Chat shows user message
- [ ] Chat shows AI confirmation: "ðŸ¤– ÄÃ£ phÃ¡t hiá»‡n yÃªu cáº§u giao viá»‡c!"

---

### STEP 3: AI Generation
```
1. Wait 1 second
2. Watch for Gemini API call
```

**Expected Console Output:**
```javascript
ðŸ¤– Auto-Delegate: Generating AI task suggestions... {hasContext: true}
âœ… Auto-Delegate: AI generated suggestions {length: 3000+}
```

**Expected Network Activity:**
```
POST https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent
Status: 200 OK
Response: JSON with candidates[0].content.parts[0].text
```

**Verification:**
- [ ] API call successful (200)
- [ ] Response contains Vietnamese text
- [ ] Response has task format (TASK 1:, TASK 2:, etc.)
- [ ] Response length > 2000 chars

---

### STEP 4: Navigation
```
1. After 1 second delay
2. Automatically navigate to /ai-task-delegator
```

**Expected Behavior:**
```
- URL changes to: http://localhost:9001/ai-task-delegator
- Page receives autoGenerated tasks via navigate state
- Textarea pre-filled with AI suggestions
```

**Expected Console Output:**
```javascript
ðŸŽ¯ Auto-Delegate: Received AI-generated tasks {length: 3427, context: {...}}
```

**Verification:**
- [ ] URL changed successfully
- [ ] Textarea contains AI-generated tasks
- [ ] "Smart Analysis" button visible
- [ ] Employee dropdown shows options
- [ ] No 400 errors (companies query)

---

### STEP 5: Task Analysis
```
1. Click "Smart Analysis" button
2. Watch AI parse tasks
```

**Expected Console Output:**
```javascript
ðŸ¤– Analyzing tasks with AI...
âœ… Analysis complete: {taskCount: 5, employees: [...]}
```

**Expected Behavior:**
```
- Loading spinner appears
- AI parses text into structured tasks
- Each task has:
  âœ“ Title
  âœ“ Description
  âœ“ Priority (high/medium/low)
  âœ“ Category (operations/hr/finance/sales)
  âœ“ Due date
```

**Verification:**
- [ ] Analysis completes without errors
- [ ] 3-10 tasks extracted
- [ ] Each task has required fields
- [ ] Task cards rendered properly

---

### STEP 6: Employee Assignment
```
1. Review parsed tasks
2. Check employee suggestions
3. Select employees from dropdown
```

**Expected Behavior:**
```
- Each task shows "Suggested: [Employee Name]"
- Dropdown populated with active employees
- Can override AI suggestions
- Selected employee shows badge
```

**Verification:**
- [ ] Employee suggestions logical (based on role/workload)
- [ ] Can change assignments
- [ ] UI updates immediately
- [ ] Multiple tasks can be assigned to same employee

---

### STEP 7: Review & Approve
```
1. Review all tasks
2. Adjust priorities if needed
3. Click "Approve & Delegate All Tasks"
```

**Expected Behavior:**
```
- Confirmation dialog appears
- Shows summary: "10 tasks to 5 employees"
- Click confirm
- Tasks created in database
- Success toast: "âœ… 10 tasks delegated successfully!"
```

**Expected Database Changes:**
```sql
-- 10 new records in tasks table
INSERT INTO tasks (
  title, description, priority, category, 
  due_date, assigned_to, company_id, status
) VALUES (...);
```

**Verification:**
- [ ] All tasks created
- [ ] Employees receive notifications
- [ ] Navigate to /tasks shows new tasks
- [ ] Task details match AI suggestions

---

### STEP 8: Verify in Tasks Page
```
1. Navigate to /tasks
2. Check newly created tasks
```

**Expected:**
```
- 10 new tasks visible
- Status: pending
- Assigned employees correct
- Priorities match
- Due dates set properly
```

**Verification:**
- [ ] All tasks appear in list
- [ ] Can filter by employee
- [ ] Can filter by priority
- [ ] Task details page works
- [ ] Employees can see their assigned tasks

---

## ðŸŽ¨ UI/UX INTEGRATION CHECK

### Visual Design
- [ ] Chat interface smooth
- [ ] Keyword detection seamless (no UI jank)
- [ ] Navigation transition smooth
- [ ] Loading states clear
- [ ] Success feedback obvious

### User Flow
- [ ] Zero clicks needed (just type)
- [ ] No confusing steps
- [ ] Clear progress indicators
- [ ] Error messages helpful
- [ ] Can retry on failure

### Accessibility
- [ ] Keyboard navigation works
- [ ] Screen reader friendly
- [ ] High contrast readable
- [ ] Touch targets large enough
- [ ] Focus states visible

### Performance
- [ ] Detection: < 100ms
- [ ] AI generation: 2-5 seconds
- [ ] Navigation: instant
- [ ] Task parsing: < 1 second
- [ ] Database insert: < 2 seconds

### Error Handling
- [ ] No API key â†’ Clear message
- [ ] No company â†’ Friendly error
- [ ] No employees â†’ Suggest add
- [ ] AI timeout â†’ Retry option
- [ ] Network error â†’ Show offline mode

---

## ðŸ› KNOWN ISSUES TO CHECK

### Fixed âœ…
- [x] Missing icon for 'prediction' type
- [x] Database query using ceo_id instead of owner_id
- [x] Keyword detection not triggering
- [x] Component undefined error

### To Monitor âš ï¸
- [ ] Rate limit on Gemini API (60 req/min)
- [ ] Large task text (>10 tasks) parsing
- [ ] Unicode/emoji in task titles
- [ ] Concurrent delegate requests
- [ ] Browser back button behavior

---

## ðŸš€ SUCCESS CRITERIA

**Flow is SUCCESSFUL if:**
1. âœ… User types delegation keyword
2. âœ… AI detects intent automatically
3. âœ… Gemini generates 3-10 intelligent tasks
4. âœ… Tasks pre-filled in delegator
5. âœ… Employee suggestions make sense
6. âœ… Tasks created successfully
7. âœ… Employees notified
8. âœ… CEO sees confirmation
9. âœ… Zero errors in console
10. âœ… Entire flow < 10 seconds

**UX is EXCELLENT if:**
- Natural language works ("giao viá»‡c", "delegate", "phÃ¢n cÃ´ng")
- No manual button clicks needed
- AI suggestions accurate and contextual
- Employee matches logical
- Feedback immediate and clear
- Can retry/undo if needed

---

## ðŸ“ TEST RESULTS

**Test Date:** December 10, 2025  
**Tester:** [Your Name]  
**Environment:** localhost:9001  
**Browser:** [Chrome/Firefox/Safari]

### Results:
- [ ] PASS - All steps successful
- [ ] PASS - No console errors
- [ ] PASS - UI smooth and responsive
- [ ] PASS - Tasks created correctly
- [ ] PARTIAL - [Note issues]
- [ ] FAIL - [List failures]

### Notes:
```
[Add any observations, bugs found, or suggestions]
```

### Screenshots:
1. Chat detection
2. AI response
3. Task delegator
4. Success confirmation
5. Tasks page

---

## ðŸŽ¯ NEXT IMPROVEMENTS

After successful E2E test:
- [ ] Add undo delegation feature
- [ ] Add task templates
- [ ] Add bulk edit assignments
- [ ] Add delegation history
- [ ] Add performance analytics
- [ ] Add A/B test keyword variations
